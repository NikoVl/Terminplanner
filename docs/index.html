<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Terminübersicht – Google Kalender Free/Busy</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
      background: #f9f9f9;
      color: #333;
    }
    #busy-times {
      margin-top: 1rem;
      background: white;
      padding: 1rem;
      border-radius: 6px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
    .busy-slot {
      border-bottom: 1px solid #ccc;
      padding: 0.4rem 0;
    }
  </style>
  <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>

  <h1>Terminübersicht</h1>
  <p>Hier sehen Sie, wann Termine bereits vergeben sind.</p>

  <div id="busy-times">
    <h2>Belegte Zeiten (nächste 7 Tage)</h2>
    <div id="slots">Lade Daten...</div>
  </div>

  <script>
    const calendarId = 'DEIN_KALENDER_ID@group.calendar.google.com'; // <- HIER DEINE ID EINFÜGEN
    const API_KEY = 'AIzaSyB2oW---HIER-KANN-DEIN-API-SCHLÜSSEL-HIN---'; // ← Eigener API-Schlüssel

    function start() {
      gapi.client.init({
        apiKey: API_KEY,
        discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"]
      }).then(listBusyTimes).catch(err => {
        document.getElementById('slots').innerText = 'Fehler: ' + err.message;
        console.error(err);
      });
    }

    function listBusyTimes() {
      const now = new Date();
      const timeMin = now.toISOString();
      const timeMax = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000).toISOString();

      gapi.client.calendar.freebusy.query({
        resource: {
          timeMin: timeMin,
          timeMax: timeMax,
          timeZone: 'Europe/Berlin',
          items: [{ id: calendarId }]
        }
      }).then(response => {
        const slotsDiv = document.getElementById('slots');
        slotsDiv.innerHTML = '';

        const busy = response.result.calendars[calendarId].busy || [];
        if (busy.length === 0) {
          slotsDiv.innerText = 'Der Kalender ist in den nächsten 7 Tagen frei.';
        } else {
          busy.forEach(slot => {
            const start = new Date(slot.start);
            const end = new Date(slot.end);
            const div = document.createElement('div');
            div.className = 'busy-slot';
            div.textContent = `Von ${start.toLocaleString()} bis ${end.toLocaleString()}`;
            slotsDiv.appendChild(div);
          });
        }
      }).catch(err => {
        document.getElementById('slots').innerText = 'Fehler beim Abrufen: ' + err.message;
        console.error(err);
      });
    }

    function loadGAPI() {
      gapi.load('client', start);
    }

    window.onload = loadGAPI;
  </script>

</body>
</html>
